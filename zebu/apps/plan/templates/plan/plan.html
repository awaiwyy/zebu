{% extends "base.html" %} 
{% block csslink %}
<link href="/static/css/chosen.css" type="text/css" rel="stylesheet" />
<link href="/static/plan/css/plan.css" type="text/css" rel="stylesheet" />
<link href="/static/css/application.css" type="text/css" rel="stylesheet" />
<link href="/static/css/filter.css" type="text/css" rel="stylesheet" />
<link href="/static/css/bootstrap-datetimepicker.css" type="text/css" rel="stylesheet"/>
<link href="/static/css/jquery.dataTables.css" type="text/css" rel="stylesheet"/>
<style type="text/css">
        .bg{ display: none;  position: absolute;  top: 0%;  left: 0%;  width: 100%;  height: 100%;  background-color: black;  z-index:1001;  -moz-opacity: 0.7;  opacity:.70;  filter: alpha(opacity=70);}
        .shownote{ display: none;  position: absolute;  top: 75%;  left: 30%; height: 80px; width: 30%; line-height:80px; border: 1px solid #E8E9F7;  background-color: white;  z-index:1002;text-align:center;font-size:14px}
</style>
{% endblock %}
{% block content %}
		

			<!--弹出模态框（Modal） -->
			<div class="modal fade" id="NewPlanModal" tabindex="-1" role="dialog"
				aria-labelledby="NewPlanModalLabel" aria-hidden="true">
				<div class="modal-dialog" style="width: 800px">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal"
								aria-hidden="true">&times;</button>
							<h4 class="modal-title" id="NewPlanModalLabel">New Plan</h4>
						</div>
						<div class="modal-body">
							<form class="newPlanForm" method="POST">
								{% csrf_token %} <input type="hidden" name="newPlanId">
								<table class="newPlanTable">
									<tr>
										<th scope="col" width="84px"><span>&nbsp;&nbsp;</span></th>
										<th scope="col" width="84px"><span>ID</span></th>
										<th scope="col" width="120px"><span>Product</span></th>
										<th scope="col" width="120px"><span>TF case</span></th>
										<th scope="col" width="360px"><span>Action
												Description</span></th>
									</tr>
									{% for tab in request_tab %}
									<tr>
										<td><input class="newPlanBox" type="checkbox"
											id="newPlan{{tab.id}}" name="newPlan{{tab.id}}" value='N'></td>
										<td>{{tab.id}}</td>
										<td>{{tab.project}}</td>
										<td>{{tab.tf_case}}</td>
										<td>{{tab.action_discription|safe}}</td>
									</tr>
									<script type="text/javascript">
										$(function() {
											$("#newPlan{{tab.id}}").prop(
													"checked", false);
											$("#newPlan{{tab.id}}").val("N");
											$("#newPlan{{tab.id}}").click(
													function() {
														if ($(this).is(
																":checked")) {
															$(this).val("Y");
														} else {
															$(this).val("N");
														}
													});
										});
									</script>
									{% endfor %}
								</table>
								<div class="newPlanDiv">
									<button class="newPlanBtn" type="text"
										style="background-color: #FB8C8C" data-dismiss="modal">cancel</button>
									<button class="newPlanBtn" type="submit"
										style="background-color: #67D00B">confirm</button>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>	
			<div class="content">
            <div class="container-fluid">
				<div class="row">
				<div class="col-lg-12">
				<button class="btn btn-fill btn-info" style="margin-bottom: 10px" onclick="location.href='exportTab'" >Export
								Excel</button>
				</div>
				</div>
				<div class="row">
					<div class="col-lg-12">
					<div class="CText">
				<p>
					<span class="contents">Product：</span> 
					<button id="select_all_product" class="btn btn-xs" onclick="select_all('product')">ALL</button>
					{% for tab in productlist %}
            		<button id="p{{forloop.counter}}" name="filter-product" class="btn btn-white btn-xs" aria-checked="false">{{tab}}</button>
					{% endfor %}
				</p>
				<p>
					<span class="contents" style="padding-right:12px">Status：</span> 
					<button id="select_all_status" class="btn btn-xs" onclick="select_all('status')">ALL</button>
            		{% for tab in statuslist %}
            		<button id="s{{forloop.counter}}" name="filter-status" class="btn btn-white btn-xs" aria-checked="false">{{tab}}</button>
					{% endfor %}
				</p>
				<p><button onclick="dofilter()" class="btn btn-fill btn-info">Go</button></p>
				<input style="display:none" id="filter" value="{{filter}}" />
			</div>
				</div>
				</div>
				<div class="row">
					<div class="col-lg-12">
					<div class="classify pull-right">				
					{% ifnotequal order "project" %}
					{% ifnotequal order "-project" %}
					<button type="button" class="classification" id="mybtn" style="background-color: #F8F8F8" aria-current="normal">Product</button>
					{% endifnotequal %}
					{% endifnotequal %}
					{% ifequal order "project" %}
					<button type="button" class="classification_up" id="mybtn" style="background-color: #F8F8F8" aria-current="up">Product</button>
					{% endifequal %}
					{% ifequal order "-project" %}
					<button type="button" class="classification_down" id="mybtn" style="background-color: #F8F8F8" aria-current="down">Product</button>
					{% endifequal %}
			
					{% ifnotequal order "status" %}
					{% ifnotequal order "-status" %}
					<button type="button" class="classification" id="mybtn1" style="background-color: #F8F8F8" aria-current="normal">Status</button>
					{% endifnotequal %}
					{% endifnotequal %}
					{% ifequal order "status" %}
					<button type="button" class="classification_up" id="mybtn1" style="background-color: #F8F8F8" aria-current="up">Status</button>
					{% endifequal %}
					{% ifequal order "-status" %}
					<button type="button" class="classification_down" id="mybtn1" style="background-color: #F8F8F8" aria-current="down">Status</button>
					{% endifequal %}
					</div>
					</div>
				</div>
            <div class="row">                   
            <div class="col-md-12">
				<div class="card dataTables_wrapper">
				{% if perms.request.change_requesttable %}
				<div class="header" data-toggle="modal" data-target="#NewPlanModal"  style="cursor:pointer;margin-bottom: 10px">
				<img src="/static/images/tianjia.png" />
					<span Style="color:#6bd5f8;font-size: 16px">Add New TF case</span>
				</div>
				{% endif %}
				<div class="content table-responsive table-full-width">
					<table class="table table-hover table-striped">
						<thead>
						<tr>
							<th scope="col" ><span>Product</span></th>
							<th scope="col" ><span>Module</span></th>
							<th scope="col" ><span>Action
									Description</span></th>
							<th scope="col" ><span>Owner</span></th>
							<th scope="col" ><span>Status</span></th>
							<th scope="col"><span>Start Time</span></th>
							<th scope="col" ><span>Detail</span></th>
						</tr>
						</thead>
						{% for tab in plan_tab %}
						<tr id="planItem{{tab.id}}">
							<td id=project{{tab.id}}>{{tab.project}}</td>
							<td id=module{{tab.id}}>{{tab.module}}</td>
							<td id=action_discription{{tab.id}}>{{tab.action_discription|safe}}</td>
							<td >{{tab.owner}}</td>
							<td id=status{{tab.id}}>{{tab.status}}</td>
							<td id=start_time{{tab.id}}>{{tab.start_time | date:"Y-m-d H:i:s"}}</td>
							<td><a data-toggle="modal"
								data-target="#planModal{{tab.id}}" style="cursor: pointer"><img
									style="vertical-align: middle" src="/static/images/down.png" /></a></td>
							<td style="display:none">{{tab.isdelay}}</td>
						</tr>
						<script type="text/javascript">
							$(function() {
								var statustd = document.getElementById(
										"planItem{{tab.id}}")
										.getElementsByTagName("td");
								if ("delay" == statustd[7].innerHTML) {
									$('#planItem{{tab.id}}').css(
											'background-color', 'red');
								}
							});
						</script>
						<!--弹出模态框（Modal） -->
						<div class="modal fade" id="planModal{{tab.id}}" tabindex="-1"
							role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
							<div class="modal-dialog" style="width: 800px">
								<div class="modal-content">
									<div id="bg{{tab.id}}" class="bg"></div>
									<div id="shownote{{tab.id}}" class="shownote"> Please wait ...</div>
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal"
											aria-hidden="true">&times;</button>
										<h4 class="modal-title" id="planModalLabel">Application
											List</h4>
									</div>
									<div class="modal-body">
										<div class="modalForm">
											<div class="modalFormContent" id="readPlanDiv{{tab.id}}">
												<!--  <div class="new_request_title">Application List</div> -->
												<ul>
													<li class="rqleft">ID:</li>
													<li class="borderBottom">{{tab.id}}</li>
												</ul>
												<ul>
													<li class="rqleft">Product:</li>
													<li id="product{{tab.id}}" class="borderBottom" >{{tab.project}}</li>
												</ul>
												<ul>
													<li class="rqleft">Classification:</li>
													<li id="readClassification{{tab.id}}" class="borderBottom">{{tab.classification}}</li>
												</ul>
												<ul>
													<li class="rqleft">Module:</li>
													<li id="readmodule{{tab.id}}" class="borderBottom">{{tab.module}}</li>
												</ul>
												<ul>
													<li class="rqleft">TF Case:</li>
													<li id="tf_case{{tab.id}}" class="borderBottom">{{tab.tf_case}}</li>
												</ul>
												<ul>
													<li class="rqleft">Action Description:</li>
													<li id="readaction_discription{{tab.id}}" class="borderBottom">{{tab.action_discription|safe}}</li>
												</ul>
												<ul>
													<li class="rqleft">Environment:</li>
													<li id="environment{{tab.id}}" class="borderBottom">{{tab.environment}}</li>
												</ul>
												<ul>
													<li class="rqleft">Owner:</li>
													<li class="borderBottom">{{tab.owner}}</li>
												</ul>
												<ul>
													<li class="rqleft">Priority:</li>
													<li id="priority{{tab.id}}" class="borderBottom">{{tab.priority}}</li>
												</ul>
												<ul id="viewStatus{tab.id}">
													<li class="rqleft">Status:</li>
													<li id="readstatus{{tab.id}}" class="borderBottom">{{tab.status}}</li>
												</ul>
												<ul id="viewProgress{{tab.id}}">
													<li class="rqleft">Progress:</li>
													<li id="progress{{tab.id}}" class="borderBottom">{{tab.progress |safe}}</li>
												</ul>
												<ul>
                                                <li class="rqleft">Request Resource ID:</li>
                                                <li id="serverid{{tab.id}}" class="borderBottom">{{tab.server_ID}}</li>
                                            </ul>
                                             <ul>
                                                <li class="rqleft">Request Start Time:</li>
                                                <li class="borderBottom">{{tab.application_time | date:"Y-m-d H:i"}}</li>
                                            </ul>
											<ul>
                                                <li class="rqleft">Assigned Resource ID:</li>
                                                <li id="assignid{{tab.id}}" class="borderBottom">{{tab.assign_ID}}</li>
                                            </ul>
                                             <ul>
                                                <li class="rqleft">Assigned Time:</li>
                                                <li class="borderBottom">
													<span id="from{{tab.id}}">{% if tab.assign_starttime%}From:{%else%}{% endif%}</span> 
													<span id="assign_starttime{{tab.id}}">{{tab.assign_starttime | date:"Y-m-d H:i"}}</span> 
													<span id="to{{tab.id}}">{% if tab.assign_starttime%}To:{%else%}{% endif%}</span> 
													<span id="assign_endtime{{tab.id}}">{{tab.assign_endtime | date:"Y-m-d H:i"}}</span>
													
												 </li>
											 </ul>
												<ul id="viewStime{{tab.id}}">
													<li class="rqleft">Start Time:</li>
													<li id="readstart_time{{tab.id}}" class="borderBottom">{{tab.start_time | date:"Y-m-d H:i:s"}}</li>
												</ul>
												<ul>
													<li class="rqleft">Request Duration:</li>
													<li id="request_duration{{tab.id}}" class="borderBottom">{{tab.request_duration}}</li>
												</ul>
												<ul>
													<li class="rqleft">Daily Duration:</li>
													<li id="daily_duration{{tab.id}}" class="borderBottom">{{tab.daily_duration}}</li>
												</ul>
												<ul>
													<li class="rqleft">Total Duration:</li>
													<li id="duration{{tab.id}}" class="borderBottom">{{tab.duration}}Hour</li>
												</ul>
												<ul id="viewCtime{{tab.id}}">
													<li class="rqleft">Close Time:</li>
													<li id="close_time{{tab.id}}" class="borderBottom">{{tab.close_time | date:"Y-m-d H:i:s"}}</li>
												</ul>
												<ul >
													<li class="rqleft">Next Target:</li>
													<li id="next_target{{tab.id}}" class="borderBottom">{{tab.next_target}}</li>
												</ul>
												 <ul>
								      <li class="rqleft">Acceptance:</li>
								      <li class="borderBottom">{{tab.acceptance}}</li>
								  </ul>
											</div>
											{% if perms.request.change_requesttable%}
											<div id="editPlanForm{{tab.id}}">
												<form class="modalForm" method="POST" id="{{tab.id}}">
													{% csrf_token %}
													<div class="modalFormContent">
														<ul>
															<li class="rqleft">ID:</li>
															<li class="borderBottom"><input id="idEdit"
																type="text" name="idEdit" value={{tab.id}} readonly>
															</li>
														</ul>
														<ul>
															<li class="rqleft">Product:</li>
															<li><span> <select class="borderWidth"
																	name="projectEdit" id="projectEdit{{tab.id}}">
																		<option selected>{{tab.project}}</option>
																		{%for i in productlist%}
                                      										<option>{{i}}</option>
									 					 				{%endfor%}
																</select>
															</span></li>
														</ul>
														<ul>
															<li class="rqleft">Classification:</li>
															<li><span> <select class="borderWidth"
																	name="classificationEdit" id="classificationEdit{{tab.id}}">
																		<option selected>{{tab.classification}}</option>
																		<option>Function</option>
																		<option>Misc</option>
																		<option>Performance</option>
																		<option>Power</option>
																		<option>Thermal</option>
																		<option>Kernel</option>
																		<option>Other</option>
																</select>
															</span></li>
														</ul>
														<ul>
															<li class="rqleft">Module:</li>
															<li><span> <select class="borderWidth"
																	name="moduleEdit" id="moduleEdit{{tab.id}}">
																		<option selected>{{tab.module}}</option>
																		<option>APPS</option>
																		<option>BSP</option>
																		<option>MM</option>
																		<option>Modem</option>
																		<option>Power</option>
																		<option>Stability</option>
																		<option>Kernel</option>
																		<option>Graphics</option>
																		<option>DDR</option>
																		<option>WCN</option>
																</select>
															</span></li>
														</ul>
														<ul>
															<li class="rqleft">TF Case:</li>
															<li><span> <select class="borderWidth"
																	id="tfcaseEdit{{tab.id}}" name="tfcaseEdit">
																		<option selected="">{{tab.tf_case}}</option>
																		<option>Power-CHIP</option>
																		<option>Power-DISP</option>
																		<option>Power-MM</option>
																		<option>Power-GPU</option>
																		<option>Power-Modem</option>
																		<option>Performance-DDR</option>
																		<option>Performance-Benchmark</option>
																		<option>Performance-GPU</option>
																		<option>Performance-DISP</option>
																		<option>Performance-Storage</option>
																		<option>Performance-USB</option>
																		<option>Fun-DISP</option>
																		<option>Fun-CV</option>
																		<option>Fun-Android boot</option>
																		<option>Fun-GPU</option>
																		<option>Fun-SEC</option>
																		<option>Fun-DDR</option>
																		<option>Fun-Storage</option>
																		<option>Fun-USB/ADB</option>
																		<option>Fun-RomCode</option>
																		<option>Fun-SPL</option>
																		<option>Fun-Uboot</option>
																		<option>Fun-Kernel</option>
																		<option>Fun-TinyAndroid</option>
																		<option>ZEBU Platform</option>
																</select>
															</span></li>
														</ul>
														<ul>
															<li class="rqleft">Action Description:</li>
															<li><textarea class="borderWidth modalText"
																	id="actionDiscriptionEdit{{tab.id}}"
																	name="actionDiscriptionEdit" style=vertical-align:text-top>{{tab.action_discription}}</textarea>
															</li>
														</ul>
														<ul>
															<li class="rqleft">Environment:</li>
															<li><span> <select class="borderWidth"
																	name="environmentEdit" id="environmentEdit{{tab.id}}">
																		<option selected>{{tab.environment}}</option>
																		<option>Zebu-JC</option>
                                     									<option>Zebu-SPRD</option>
																		<option>Hybrid</option>
																</select>
															</span></li>
														</ul>
														<ul>
															<li class="rqleft">Owner:</li>
															<li class="borderBottom"><input size="30"
																type="text" name="ownerEdit" id="ownerEdit{{tab.id}}" value={{tab.owner}} readonly>
															</li>
														</ul>
														<ul>
															<li class="rqleft">Priority:</li>
															<li><span> <select class="borderWidth"
																	id="priorityEdit{{tab.id}}" name="priorityEdit">
																		<option selected>{{tab.priority}}</option>
																		<option>High</option>
																		<option>Normal</option>
																		<option>Low</option>
																</select>
															</span></li>
														</ul>
														<ul>
															<li class="rqleft">Status:</li>
															<li><span> <select class="borderWidth"
																	id="statusEdit{{tab.id}}" name="statusEdit">
																		<option selected>{{tab.status}}</option>
																		<option>wait for bitfile</option>
																		<option>wait for SW</option>
																		<option>wait for zebu</option>
																		<option>ongoing</option>
																		<option>suspend</option>
																		<option>close</option>
																</select>
															</span></li>
														</ul>
														<ul>
															<li class="rqleft">Progress:</li>
															<li><textarea class="borderWidth modalText"
																	id="progressEdit{{tab.id}}" name="progressEdit" style=vertical-align:text-top>{{tab.progress}}</textarea>
															</li>
														</ul>
														<ul>
                                                        <li class="rqleft">Request Resource ID:</li>
														<li  class="borderBottom">{{tab.server_ID}}</li>
                                                    </ul>
                                                    <ul>
                                                        <li class="rqleft">Request Start Time:</li>
                                                        <li class="borderBottom">
                                                            <span>
                                                                <input size="16" type="text" value="{{tab.application_time | date:'Y-m-d H:i'}}" readonly id="applicationTimeEdit{{tab.id}}" name="applicationTimeEdit" >
                                                            </span>
                                                        </li>
														</ul>
														
														<ul>
                                                        <li class="rqleft">Assigned Resource ID:</li>
                                                        <li>
														<div class="input-group">
															<select data-placeholder=" " class="chosen-select" multiple tabindex="4" id="assignIdEdit{{tab.id}}" name="assignIdEdit">
																{% for key,value in assignid_list.items %}
																{% ifequal key tab.id %}
																{% for index in value.0%}
																<option selected value={{index}}>{{index}}</option>
																{% endfor%}
																{% for index in value.1%}
																<option value={{index}}>{{index}}</option>
																{% endfor%}
																{% endifequal%}
																{% endfor%}
															</select>
														</div>
														<p id="checkassignid{{tab.id}}" style="text-align:left;color:red"></p>
                                                        </li>		
                                                    </ul>
                                                    <ul>
                                                        <li class="rqleft">Assigned Time:</li>
                                                        <li>
                                                            <span>
                                                                From:<input style="line-height:normal" size="16" type="text" value="{{tab.assign_starttime | date:'Y-m-d H:i'}}" id="assign_starttimeEdit{{tab.id}}" name="assign_starttimeEdit" class="form_datetime">
																To:<input style="line-height:normal" size="16" type="text" value="{{tab.assign_endtime | date:'Y-m-d H:i'}}" id="assign_endtimeEdit{{tab.id}}" name="assign_endtimeEdit" class="form_datetime">
                                                            </span>
															<p id="checkassigntime{{tab.id}}" style="text-align:left;color:red"></p>
															<p id="checkassigntime1{{tab.id}}" style="text-align:left;color:red"></p>
                                                        </li>
														</ul>
														<ul>
															<li class="rqleft">Start Time:</li>
															<li><select name="yearEdit" id ="startyearid{{tab.id}}">
																	<option selected>{{tab.start_time | date:"Y"}}</option>
																	{% for year in valid_time.0 %}
																	<option>{{year}}</option> {% endfor %}
															</select> <select name="monthEdit" id ="startmonthid{{tab.id}}">
																	<option selected>{{tab.start_time | date:"m"}}</option>
																	{% for month in valid_time.1 %}
																	<option>{{month}}</option> {% endfor %}
															</select> <select name="dayEdit" id ="startdayid{{tab.id}}">
																	<option selected>{{tab.start_time | date:"d"}}</option>
																	{% for day in valid_time.2 %}
																	<option>{{day}}</option> {% endfor %}
															</select> &nbsp;&nbsp;&nbsp;&nbsp; <select name="hourEdit" id ="starthourid{{tab.id}}">
																	<option selected>{{tab.start_time | date:"H"}}</option>
																	{% for hour in valid_time.3 %}
																	<option>{{hour}}</option> {% endfor %}
															</select> <select name="minuteEdit" id ="startminuteid{{tab.id}}">
																	<option selected>{{tab.start_time | date:"i"}}</option>
																	{% for min in valid_time.4 %}
																	<option>{{min}}</option> {% endfor %}
															</select> <select name="secondEdit" id ="startsecondid{{tab.id}}">
																	<option selected>{{tab.start_time | date:"s"}}</option>
																	{% for sec in valid_time.4 %}
																	<option>{{sec}}</option> {% endfor %}
															</select></li>
														</ul>
														<p id="starttime{{tab.id}}" style="text-align:center;color:red"></p>
														<ul>
															<li class="rqleft">Request Duration:</li>
															<!-- <li><span> <select class="borderWidth"
																	id="requestDuration" name="requestDurationEdit">
																		<option selected>{{tab.request_duration}}</option> 
																		{%for i in valid_duration %}
																		<option>{{i}}</option> {% endfor %}
																</select>
															</span></li> -->
															<li><select name="durationHourEdit" id="durationHourEdit{{tab.id}}">

																	<option selected>{{tab.request_duration | cut:"Hour"|cut:"Day"|cut:"Piece"| get_digit:"6" }}{{tab.request_duration | cut:"Hour"|cut:"Day"|cut:"Piece"| get_digit:"5" }}</option>
																	{% for hour in valid_duration.0 %}
																	<option>{{hour}}</option> {% endfor %}
															</select>Hour<select name="durationDayEdit" id="durationDayEdit{{tab.id}}">
																	<option selected>{{tab.request_duration | cut:"Hour"|cut:"Day"|cut:"Piece"| get_digit:"4" }}{{tab.request_duration | cut:"Hour"|cut:"Day"|cut:"Piece"| get_digit:"3" }}</option>
																	{% for day in valid_duration.1 %}
																	<option>{{day}}</option> {% endfor %}
															</select>Day<select name="durationPieceEdit" id="durationPieceEdit{{tab.id}}">
																	<option selected>{{tab.request_duration | cut:"Hour"|cut:"Day"|cut:"Piece"| get_digit:"2" }}{{tab.request_duration | cut:"Hour"|cut:"Day"|cut:"Piece"| get_digit:"1" }}</option>
																	{% for piece in valid_duration.2 %}
																	<option>{{piece}}</option> {% endfor %}
															</select>Piece</li>
														</ul>
														<ul>
															<li class="rqleft">Daily Duration:</li>
															<!-- <li class="borderBottom"><input id="dailyDurationEdit"
																name="dailyDurationEdit" type="text" value="{{tab.daily_duration}}"
																readonly></input></li> -->
															<li><select name="dailyduraHourEdit" id="dailyduraHourEdit{{tab.id}}">
																	<option selected>{{tab.daily_duration | cut:"None"|cut:"Hour"|cut:"Piece"| get_digit:"4" }}{{tab.daily_duration | cut:"None"|cut:"Hour"|cut:"Piece"| get_digit:"3" }}</option>
																	{% for hour in valid_dailyDura.0 %}
																	<option>{{hour}}</option> {% endfor %}
															</select>Hour<select name="dailyduraPieceEdit" id="dailyduraPieceEdit{{tab.id}}">
																	<option selected>{{tab.daily_duration | cut:"None"|cut:"Hour"|cut:"Piece"| get_digit:"2" }}{{tab.daily_duration | cut:"None"|cut:"Hour"|cut:"Piece"| get_digit:"1" }}</option>
																	{% for piece in valid_dailyDura.1 %}
																	<option>{{piece}}</option> {% endfor %}
															</select>Piece</li>
														</ul>
														<ul>
													<li class="rqleft">Total Duration:</li>
													<li id="totalduration{{tab.id}}" class="borderBottom">{{tab.duration}}Hour</li>
													<li><img style="right:16px" src="/static/images/bianji.png" onclick="showHistory({{tab.id}})"></li>
												</ul>
														<div id="history{{tab.id}}" style="height:100px;overflow-x:scroll;display:none" aria-checked="false">
														<span id="historyspan{{tab.id}}">	</span>
														{% for tab2 in history_tab %}
														{% ifequal tab2.request_id tab.id %}
														<span style="width:101px; float:left;line-height:normal;">
															<input aria-current="{{tab.id}}" style="width:100px;color: #A2A2A2;line-height:normal;" type="text" name="dateEdit" id="dateEdit{{tab2.id}}" value={{tab2.change_date | date:"Y-m-d"}}  readonly>
															<input style="width:100px;line-height:normal;" type="text" name="durationEdit" id="durationEdit{{tab2.id}}" value="{{tab2.daily_duration}}">
														</span>
														{% endifequal %}
														{% endfor %}
														<input id="changeIdlist{{tab.id}}" name="changeIdlist"  style="text-align:center" hidden />
														</div>
														<!-- <ul>
															<li class="rqleft">Total Duration:</li>
															<li class="borderBottom"><input id="durationEdit"
																name="durationEdit" type="text" value="{{tab.duration}}"
																readonly></input></li>
														</ul> -->

														<ul>
															<li class="rqleft">Close Time:</li>
															<li><select name="closeYearEdit" id="closeyearid{{tab.id}}">
																	<option selected>{{tab.close_time | date:"Y"}}</option>
																	{% for year in valid_time.0 %}
																	<option>{{year}}</option> {% endfor %}
															</select> <select name="closeMonthEdit" id="closemonthid{{tab.id}}">
																	<option selected>{{tab.close_time | date:"m"}}</option>
																	{% for month in valid_time.1 %}
																	<option>{{month}}</option> {% endfor %}
															</select> <select name="closeDayEdit" id="closedayid{{tab.id}}">
																	<option selected>{{tab.close_time | date:"d"}}</option>
																	{% for day in valid_time.2 %}
																	<option>{{day}}</option> {% endfor %}
															</select> &nbsp;&nbsp;&nbsp;&nbsp; <select name="closeHourEdit" id="closehourid{{tab.id}}">
																	<option selected>{{tab.close_time | date:"H"}}</option>
																	{% for hour in valid_time.3 %}
																	<option>{{hour}}</option> {% endfor %}
															</select> <select name="closeMinuteEdit" id="closeminuteid{{tab.id}}">
																	<option selected>{{tab.close_time | date:"i"}}</option>
																	{% for min in valid_time.4 %}
																	<option>{{min}}</option> {% endfor %}
															</select> <select name="closeSecondEdit" id="closesecondid{{tab.id}}">
																	<option selected>{{tab.close_time | date:"s"}}</option>
																	{% for sec in valid_time.4 %}
																	<option>{{sec}}</option> {% endfor %}
															</select></li>
														</ul>
														<p id="closetime{{tab.id}}" style="text-align:center;color:red"></p>
														<p id="checkStart{{tab.id}}" style="text-align:center;color:red"></p>
														<p id="checkclose{{tab.id}}" style="text-align:center;color:red"></p>
														<p id="checkClose1{{tab.id}}" style="text-align:center;color:red"></p>
														<ul>
															<li class="rqleft">Next Target:</li>
															<li><textarea class="borderWidth modalReportText"
																	id="next_targetEdit{{tab.id}}" name="next_targetEdit">{{tab.next_target}}</textarea>
															</li>
														</ul>
														<ul>
									     <li class="rqleft">Acceptance:</li>
									     <li class="borderBottom">
                                  <input id="acceptanceEdit{{tab.id}}" type="text" name=acceptanceEdit" value={{tab.acceptance}} readonly>
                                </li>
								      </ul>
								      <input id="userInfo{{tab.id}}" type="hidden" name="userInfo" value={{user.username}} />
													</div>
													<div align="center" style="margin-bottom: 100px;">
														<button class="requestBtn" type="button"
															id="cancleBtn{{tab.id}}" name="cancle"
															style="background-color: #FB8C8C" >cancel</button>
														<button class="requestBtn" name="ok" type="button" onclick="submitModal({{tab.id}})" id="confirmBtn{{tab.id}}"
															style="background-color: #67D00B">confirm</button>
													</div>
												</form>
											</div>
											<div align="center" style="margin-bottom: 100px;">
												{% if perms.request.change_requesttable%}
												<button class="requestBtn" id="editBtn{{tab.id}}"
													type="text" name="edit" style="background-color: #FB8C8C">Edit</button>
												<button class="requestBtn" id="delBtn{{tab.id}}"
													type="submit" name="delete"
													style="background-color: #67D00B" data-toggle="modal"
													data-target="#delPlanModal{{tab.id}}"
													style="cursor:pointer">Delete</button>
												<!-- 模态框（Modal） -->
												<div class="modal fade" id="delPlanModal{{tab.id}}"
													tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
													aria-hidden="true" style='margin: 150px 0 '>
													<div class="modal-dialog planDelForm">
														<div class="modal-content">
															<div class="modal-header">
																<!-- <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> -->
																<h4 class="modal-title" id="myModalLabel">Delete
																	the plan item ?</h4>
															</div>
															<div class="modal-body">
																<form class="delForm" method="POST">
																	{% csrf_token %} <input type="text" name="delPlanId"
																		value={{tab.id}} hidden />
																	<div align="center" style="margin-bottom: 50px;">
																		<button class="requestBtn" type="text"
																			id="cancleDelBtn{{tab.id}}" name="cancle"
																			style="background-color: #FB8C8C"
																			data-dismiss="modal">Cancel</button>
																		<button class="requestBtn" name="ok" type="submit"
																			style="background-color: #67D00B">confirm</button>
																	</div>
																</form>
															</div>
														</div>
													</div>
												</div>
												<!-- delete plan table modal finish-->
												{% endif %}
												<!-- delete plan table finish-->

												<script type="text/javascript">
													$(document)
															.ready(
																	function() {
																		/* for view or edit*/
																		$(
																				"#editPlanForm{{tab.id}}")
																				.hide();
																		$(
																				"#editBtn{{tab.id}}")
																				.click(
																						function() {
																							$(
																									"#readPlanDiv{{tab.id}}")
																									.hide();
																							$(
																									"#editPlanForm{{tab.id}}")
																									.show();
																							$(
																									this)
																									.hide();
																							$(
																									"#delBtn{{tab.id}}")
																									.hide();
																							$(
																									'#actionDiscriptionEdit{{tab.id}}')
																									.val(
																											$(
																													'#actionDiscriptionEdit{{tab.id}}')
																													.val()
																													.replace(
																															/<br>/g,
																															''));
																							$(
																									'#progressEdit{{tab.id}}')
																									.val(
																											$(
																													'#progressEdit{{tab.id}}')
																													.val()
																													.replace(
																															/<br>/g,
																															''));
																						});

																		$(
																				"#cancleBtn{{tab.id}}")
																				.click(
																						function() {
																							$(
																									"#readPlanDiv{{tab.id}}")
																									.show();
																							$(
																									"#editPlanForm{{tab.id}}")
																									.hide();
																							$(
																									"#editBtn{{tab.id}}")
																									.show();
																							$(
																									"#delBtn{{tab.id}}")
																									.show();
																						});
																	});
												</script>
											</div>

											<!-- admin user edit table :finish-->
											<!-- common user edit progress :start -->
											<!--{% elif user.username == tab.owner %}-->
											<!--<div id="comEdit{{tab.id}}">-->
												<!--<form class="modalForm" method="POST">-->
													<!--{% csrf_token %}-->
													<!--<div class="modalFormContent">-->
														<!--<ul>-->
															<!--<li class="rqleft">ID:</li>-->
															<!--<li class="borderBottom"><input id="idEditCom"-->
																<!--type="text" name="idEditCom" value={{tab.id}} readonly>-->
															<!--</li>-->
														<!--</ul>-->
														<!--<ul>-->
															<!--<li class="rqleft">Product:</li>-->
															<!--<li class="borderBottom">{{tab.project}}</li>-->
														<!--</ul>-->
														<!--<ul>-->
															<!--<li class="rqleft">Classification:</li>-->
															<!--<li id="readClassification" class="borderBottom">{{tab.classification}}</li>-->
														<!--</ul>-->
														<!--<ul>-->
															<!--<li class="rqleft">Module:</li>-->
															<!--<li class="borderBottom">{{tab.module}}</li>-->
														<!--</ul>-->
														<!--<ul>-->
															<!--<li class="rqleft">TF Case:</li>-->
															<!--<li class="borderBottom">{{tab.tf_case}}</li>-->
														<!--</ul>-->
														<!--<ul>-->
															<!--<li class="rqleft">Action Discription:</li>-->
															<!--<li class="borderBottom">{{tab.action_discription|safe}}</li>-->
														<!--</ul>-->
														<!--<ul>-->
															<!--<li class="rqleft">Environment:</li>-->
															<!--<li class="borderBottom">{{tab.environment}}</li>-->
														<!--</ul>-->
														<!--<ul>-->
															<!--<li class="rqleft">Owner:</li>-->
															<!--<li class="borderBottom">{{tab.owner}}</li>-->
														<!--</ul>-->
														<!--<ul>-->
															<!--<li class="rqleft">Priority:</li>-->
															<!--<li class="borderBottom">{{tab.priority}}</li>-->
														<!--</ul>-->
														<!--<ul id="viewStatusCom{{tab.id}}">-->
															<!--<li class="rqleft">Status:</li>-->
															<!--<li class="borderBottom">{{tab.status}}</li>-->
														<!--</ul>-->
														<!--<ul>-->
															<!--<li class="rqleft">Progress:</li>-->
															<!--<li><textarea class="borderWidth modalText"-->
																	<!--id="progressEditCom{{tab.id}}" name="progressEditCom" >{{tab.progress|safe}}</textarea>-->
															<!--</li>-->
														<!--</ul>-->
														<!--<ul id="viewStimeCom{{tab.id}}">-->
															<!--<li class="rqleft">Start Time:</li>-->
															<!--<li class="borderBottom">{{tab.start_time | date:"Y-m-d H:i:s"}}</li>-->
														<!--</ul>-->
														<!--<ul>-->
															<!--<li class="rqleft">Request Duration:</li>-->
															<!--<li class="borderBottom">{{tab.request_duration}}</li>-->
														<!--</ul>-->
														<!--<ul>-->
															<!--<li class="rqleft">Duration:</li>-->
															<!--<li class="borderBottom">{{tab.duration}}</li>-->
														<!--</ul>-->
													<!--</div>-->
													<!--<div align="center" style="margin-bottom: 100px;">-->
														<!--<button class="requestBtn" type="text"-->
															<!--id="cancleBtnCom{{tab.id}}" name="cancle"-->
															<!--style="background-color: #FB8C8C" data-dismiss="modal">cancle</button>-->
														<!--<button class="requestBtn" name="ok" type="submit"-->
															<!--style="background-color: #67D00B">confirm</button>-->
													<!--</div>-->
												<!--</form>-->
											<!--</div>-->
											<!--<div align="center" style="margin-bottom: 100px;">-->
												<!--<button class="requestBtn" type="text"-->
													<!--id="comEditBtn{{tab.id}}" name="comEdit"-->
													<!--style="background-color: #FB8C8C">Edit</button>-->
												<!--<script type="text/javascript">-->
													<!--$(document)-->
															<!--.ready(-->
																	<!--function() {-->
																		<!--/* for view or edit*/-->
																		<!--$(-->
																				<!--"#comEdit{{tab.id}}")-->
																				<!--.hide();-->

																		<!--$(-->
																				<!--"#comEditBtn{{tab.id}}")-->
																				<!--.click(-->
																						<!--function() {-->
																							<!--$(-->
																									<!--"#readPlanDiv{{tab.id}}")-->
																									<!--.hide();-->
																							<!--$(-->
																									<!--"#comEdit{{tab.id}}")-->
																									<!--.show();-->
																							<!--$(-->
																									<!--this)-->
																									<!--.hide();-->
																							<!--$(-->
																									<!--'#progressEditCom{{tab.id}}')-->
																									<!--.val(-->
																											<!--$(-->
																													<!--'#progressEditCom{{tab.id}}')-->
																													<!--.val()-->
																													<!--.replace(-->
																															<!--/<br>/g,-->
																															<!--''));-->

																							<!--var stimelis = document-->
																									<!--.getElementById(-->
																											<!--"viewStimeCom{{tab.id}}")-->
																									<!--.getElementsByTagName(-->
																											<!--"li");-->
																							<!--if (stimelis[1].innerHTML) {-->
																								<!--$(-->
																										<!--'#viewStimeCom{{tab.id}}')-->
																										<!--.show();-->
																							<!--} else {-->
																								<!--$(-->
																										<!--'#viewStimeCom{{tab.id}}')-->
																										<!--.hide();-->
																							<!--}-->
																						<!--});-->
																	<!--});-->
												<!--</script>-->
											<!--</div>-->
											{% endif %}
											<!-- common user edit progress :finish -->
											<!-- change plan table finish-->
										</div>
									</div>
								</div>
							</div>
						</div>
						
						<!-- 添加模态框（Modal）结束 -->
						{% endfor %}
					</table>
				</div>
				<div class="dataTables_info">
					Showing {{plan_tab.start_index}} to {{plan_tab.end_index}} of {{count}} entries
				</div>
				<div class="dataTables_paginate paging_simple_numbers" style="margin-bottom: 10px">
						<span class="step-links">
						{% if plan_tab.has_previous %}
							<a class="paginate_button " href="?page={{ plan_tab.number|add:-1 }}{{ otherpara }}"> Previous </a>
						{% else %}
							<a class="paginate_button disabled"> Previous </a>
						{% endif %}

						{% ifequal page_status "" %}
							{% for i in page_range %}
								{% ifequal i|add:1 plan_tab.number %}
								<a class="paginate_button current" href="?page={{ i|add:1 }}{{ otherpara }}">{{ i|add:1 }}</a>
								{% else %}
								<a class="paginate_button " href="?page={{ i|add:1 }}{{ otherpara }}">{{ i|add:1 }}</a>
								{% endifequal %}								
							{% endfor %}
						{% else %}
							{% ifequal page_status "Left" %}
								{% for i in page_show_range %}
									{% ifequal i|add:1 plan_tab.number %}
									<a class="paginate_button current" href="?page={{ i|add:1 }}{{ otherpara }}">{{ i|add:1 }}</a>
									{% else %}
									<a class="paginate_button " href="?page={{ i|add:1 }}{{ otherpara }}">{{ i|add:1 }}</a>
									{% endifequal %}
								{% endfor %}
								...
								<a class="paginate_button " href="?page={{ page_count }}{{ otherpara }}">{{ page_count }}</a>
							{% endifequal %}

							{% ifequal page_status "Right" %}
								<a class="paginate_button " href="?page=1{{ otherpara }}">1</a>
								...
								{% for i in page_right_range %}
									{% ifequal i plan_tab.number %}
									<a class="paginate_button current" href="?page={{ i }}{{ otherpara }}">{{ i }}</a>
									{% else %}
									<a class="paginate_button" href="?page={{ i }}{{ otherpara }}">{{ i }}</a>
									{% endifequal %}
								{% endfor %}						
							{% endifequal %}

							{% ifequal page_status "Mid" %}
								<a class="paginate_button " href="?page=1{{ otherpara }}">1</a>
								...
								<a class="paginate_button " href="?page={{ plan_tab.number|add:-1 }}{{ otherpara }}">{{ plan_tab.number|add:-1 }}</a>
								<a class="paginate_button current" href="?page={{ plan_tab.number }}{{ otherpara }}">{{ plan_tab.number }}</a>
								<a class="paginate_button " href="?page={{ plan_tab.number|add:1 }}{{ otherpara }}">{{ plan_tab.number|add:1 }}</a>
								...
								<a class="paginate_button" href="?page={{ page_count }}{{ otherpara }}">{{ page_count }}</a>
							{% endifequal %}
						{% endifequal %}

						{% if plan_tab.has_next %}
							<a class="paginate_button " href="?page={{ plan_tab.number|add:1 }}{{ otherpara }}"> Next </a>
						{% else %}
							<a class="paginate_button disabled"> Next </a>
						{% endif %}
						</span>
					</div>
            </div>
			</div>
			</div>
			</div>
			</div>
				
{% endblock %}
{% block scripts %}
<script src="/static/home/js/firefoxbase.js"></script>
<script src="/static/js/chosen.jquery.js"></script>
<script src="/static/js/bootstrap-datetimepicker.js"></script>
<script src="/static/js/chosen.jquery.js"></script>
<script src="/static/js/filter.js"></script>
<script type="text/javascript">
	/mobi/i.test(navigator.userAgent) && !location.hash
			&& setTimeout(function() {
				if (!pageYOffset)
					window.scrollTo(0, 1);
			}, 1000);


	function showHistory(id) {
		if($("#history"+id).attr("aria-checked") == "false"){			
			document.getElementById("history"+id).style.display='inline-block';
			$("#history"+id).attr("aria-checked","true");
		}else{
			document.getElementById("history"+id).style.display='none';
			$("#history"+id).attr("aria-checked","false");
		}
   
}


function checknull(tab_id){
	checkid=checkassignid(tab_id);
	checktime=checkassigntime(tab_id);
	if (checkid && checktime){
		return true;
	}else{
		return false;
	}
}

function checkassignid(tab_id){
	var assignid = $("#assignIdEdit" + tab_id).val();
	if(assignid == '' || assignid == null){
		$("#checkassignid"+tab_id).text("请选择Assigned Resource ID.");
		return false;
	}else{
		$("#checkassignid"+tab_id).text("");
		return true;
	}
}

function checkassigntime(tab_id){
	var assignstarttime =$("#assign_starttimeEdit" + tab_id).val();
	var assignendtime =$("#assign_endtimeEdit" + tab_id).val();
	if(assignstarttime == '' || assignendtime == ''){
		$("#checkassigntime"+tab_id).text("请填完整Assigned Time.");
		return false;
	}else{
		$("#checkassigntime"+tab_id).text("");
	}
	if(assignstarttime >= assignendtime){
		$("#checkassigntime1"+tab_id).text("Assign EndTime应晚于Assign StartTime");
		return false;
	}else{
		$("#checkassigntime1"+tab_id).text("");
	}
	return true;
}

function validatetime(tab_id) {
	var status = document.getElementById("statusEdit" + tab_id).value;
	var closeDate = new Date();
	var closeyear = document.getElementById("closeyearid" + tab_id).value;
	var closemonth = document.getElementById("closemonthid" + tab_id).value;
	var closeday = document.getElementById("closedayid" + tab_id).value;
	var closehour = document.getElementById("closehourid" + tab_id).value;
	var closeminute = document.getElementById("closeminuteid" + tab_id).value;
	var closesecond = document.getElementById("closesecondid" + tab_id).value;
	closeDate.setFullYear(closeyear, closemonth - 1, closeday);
	var startDate = new Date();
	var startyear = document.getElementById("startyearid" + tab_id).value;
	var startmonth = document.getElementById("startmonthid" + tab_id).value;
	var startday = document.getElementById("startdayid" + tab_id).value;
	var starthour = document.getElementById("starthourid" + tab_id).value;
	var startminute = document.getElementById("startminuteid" + tab_id).value;
	var startsecond = document.getElementById("startsecondid" + tab_id).value;
	startDate.setFullYear(startyear, startmonth - 1, startday);
	var today = new Date();
	if (!(startyear == "" && startmonth == "" && startday == "" && starthour == "" && startminute == "" && startsecond == "")){
		if (startyear == "" || startmonth == "" || startday == "" || starthour == "" || startminute == "" || startsecond == ""){
			$("#starttime" + tab_id).text("请填完整Start Time");
			return false;
		}
		else {
		$("#starttime" + tab_id).text("");
		}
	}
	if (!(closeyear == "" && closemonth == "" && closeday == "" && closehour == "" && closeminute == "" && closesecond == "")){
		if (closeyear == "" || closemonth == "" || closeday == "" || closehour == "" || closeminute == "" || closesecond == ""){
			$("#closetime" + tab_id).text("请填完整Close Time");
			return false;
		}
		else {
		$("#closetime" + tab_id).text("");
		}
	}
	if (closeDate>today) {
		$("#checkClose1" + tab_id).text("Close time不能是未来时间");
		return false;
	    }
		else{
			$("#checkClose1"+tab_id).text("");
		}
	if (startyear !== "")
	{
		if (closeyear !== "" && closeDate < startDate) {
		$("#checkStart" + tab_id).text("Close time不能早于Start time");
		return false;
		} else {
		$("#checkStart" + tab_id).text("");
		}
		if (closeyear == "" && status == "close") {
			$("#checkclose" + tab_id).text("请输入Close time");
			return false;
			} else {
			$("#checkclose" + tab_id).text("");
			}
	}else {
		if(closeyear !== ""){
		$("#checkclose" + tab_id).text("请先输入Start time");
		return false;
		}else {
		$("#checkclose" + tab_id).text("");
		}
	}
	return true;
}
	var flag_browser = "other";
	$(document).ready(function() {
		//判断浏览器类型
		if (window.ActiveXObject) {
			flag_browser = "ie";
		}
	})
$.ajaxSetup({
		data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
	});

function showdiv(tab_id) {
            document.getElementById("bg"+tab_id).style.display ="block";
            document.getElementById("shownote"+tab_id).style.display ="block";
        }  
function hidediv(tab_id) {
            document.getElementById("bg"+tab_id).style.display ='none';
            document.getElementById("shownote"+tab_id).style.display ='none';
        }  

$(".chosen-select").chosen();
$(".form_datetime").datetimepicker({
	format: 'yyyy-mm-dd hh:ii',
	autoclose : true});
function dofilter(){
		var getproduct = get_product();
		var getstatus = get_status();
		var getproductorder = $("#mybtn").attr("aria-current");
		var getstatusorder = $("#mybtn1").attr("aria-current");
		window.location.href="?p="+getproduct+"&s="+getstatus+"&order="+getproductorder+"&sorder="+getstatusorder;
	}
	
	// Record changed durationEdit id
$("[name='durationEdit']").change(function(){
		var pk = parseInt(this.id.match("\\d+"));	
		var id = this.form.id;
		var changed = $("#changeIdlist"+id).val();
		if (changed.indexOf(pk)<0)
		{
			changed += pk + ",";
		}
		$("#changeIdlist"+id).val(changed);
	});

function submitModal(id) {
		if ($("#changeIdlist"+id).val()!="")
		{
			var arrId = $("#changeIdlist"+id).val();
			arrId = arrId.substring(0, arrId.length-1);
			var arrIds = arrId.split(",");
			var arrVals = "";
			for (var i=0; i<arrIds.length; i++)
			{
				arrVals += $("#durationEdit" + arrIds[i]).val() + ",";
			}
			var arrVal = arrVals.substring(0, arrVals.length-1);
		}
		if(validatetime(id) && checknull(id)){
        postData(id,arrId,arrVal);
        }
    }

function postData(product_id,arrId,arrVal) {
                    $.ajax({
                        type: "POST",
                        url: "/plan/ajaxpost",
						beforeSend: function(){
							showdiv(product_id);
						},
						complete: function () {
							hidediv(product_id);
    					},
                        data: {
                            'idEdit': product_id,
							'projectEdit':$('#projectEdit' + product_id).val(),
                            'classificationEdit': $('#classificationEdit' + product_id).val(),
                            'moduleEdit': $('#moduleEdit' + product_id).val(),
                            'tfcaseEdit': $("#tfcaseEdit" + product_id).val(),
                            'actionDiscriptionEdit': $("#actionDiscriptionEdit" + product_id).val(),
                            'environmentEdit': $("#environmentEdit" + product_id).val(),
							'priorityEdit':$('#priorityEdit' + product_id).val(),
							'progressEdit':$('#progressEdit' + product_id).val(),
							
							'assignIdEdit':$('#assignIdEdit' + product_id).val(),
							'assign_starttimeEdit':$('#assign_starttimeEdit' + product_id).val(),
							'assign_endtimeEdit':$('#assign_endtimeEdit' + product_id).val(),
							'statusEdit':$('#statusEdit' + product_id).val(),
							'durationPieceEdit':$('#durationPieceEdit' + product_id).val(),
							'durationDayEdit':$('#durationDayEdit' + product_id).val(),
							'durationHourEdit':$('#durationHourEdit' + product_id).val(),
							'dailyduraPieceEdit':$('#dailyduraPieceEdit' + product_id).val(),
							'dailyduraHourEdit':$('#dailyduraHourEdit' + product_id).val(),
							'yearEdit':$('#startyearid' + product_id).val(),
							'monthEdit':$('#startmonthid' + product_id).val(),
							'dayEdit':$('#startdayid' + product_id).val(),
							'hourEdit':$('#starthourid' + product_id).val(),
							'minuteEdit':$('#startminuteid' + product_id).val(),
							'secondEdit':$('#startsecondid' + product_id).val(),
							'closeYearEdit':$('#closeyearid' + product_id).val(),
							'closeMonthEdit':$('#closemonthid' + product_id).val(),
							'closeDayEdit':$('#closedayid' + product_id).val(),
							'closeHourEdit':$('#closehourid' + product_id).val(),
							'closeMinuteEdit':$('#closeminuteid' + product_id).val(),
							'closeSecondEdit':$('#closesecondid' + product_id).val(),
							'next_targetEdit':$('#next_targetEdit' + product_id).val(),
							'ownerEdit':$('#ownerEdit' + product_id).val(),
							'userInfo':$('#userInfo' + product_id).val(),
							'arrId': arrId,
							'arrVal':arrVal
                        },

                        dataType: "json",
                        success: function (ret) {
                            //update table view
                            
                            $("#project" + product_id).text($('#projectEdit' + product_id).val());
							$("#module" + product_id).text($('#moduleEdit' + product_id).val());
							$("#action_discription" + product_id).text($('#actionDiscriptionEdit' + product_id).val());
							if ($('#closeyearid' + product_id).val()==""){
								$("#status" + product_id).text($('#statusEdit' + product_id).val());}
							else{
								$("#status" + product_id).text('close');
								$("#statusSelected" + product_id).text('close');
							}
							if(ret.edit_stime != "-- ::"){
								$("#start_time" + product_id).text(ret.edit_stime);}
								
							//update modal table
							$("#product" + product_id).text($('#projectEdit' + product_id).val());
							$("#readClassification" + product_id).text($('#classificationEdit' + product_id).val());
							$("#readmodule" + product_id).text($('#moduleEdit' + product_id).val());
							$("#tf_case" + product_id).text($('#tfcaseEdit' + product_id).val());
							$("#readaction_discription" + product_id).text($('#actionDiscriptionEdit' + product_id).val());
							$("#environment" + product_id).text($('#environmentEdit' + product_id).val());
							$("#priority" + product_id).text($('#priorityEdit' + product_id).val());
							
							$("#readstatus" + product_id).text($('#statusEdit' + product_id).val());
							$("#progress" + product_id).text($('#progressEdit' + product_id).val());
							if(ret.edit_stime != "-- ::"){
								old_start_time=$("#readstart_time" + product_id).text().substr(0,10)
								new_start_time=ret.edit_stime.substr(0,10)
								if(old_start_time != ""){
								if(new_start_time > old_start_time){
									$("input[name='dateEdit'][aria-current="+product_id+"]").each(function(i,o){
										if($(o).val() < new_start_time){
											history_id = $(o).attr('id').substr(8);
											$('#dateEdit' + history_id).remove();
											$('#durationEdit' + history_id).remove();	
										}
									});
								}else if(new_start_time < old_start_time){
									for(var i=0;i<ret.newaddidlist.length;i++){
									$("<span style='width:101px; float:left;line-height:normal;'><input aria-current="+product_id+" style='width:100px;color: #A2A2A2;line-height:normal;' type='text' name='dateEdit' id='dateEdit"+ret.newaddidlist[i][0] +"'value="+ret.newaddidlist[i][1] +"  readonly><input style='width:100px;line-height:normal;' type='text' name='durationEdit'  id='durationEdit"+ret.newaddidlist[i][0] +"' value="+ret.newaddidlist[i][2]+"></span>").appendTo('#historyspan'+product_id)
									var ori = $("#changeIdlist" + product_id).val();
									ori += ret.newaddidlist[i][0] + ",";
									$("#changeIdlist"+product_id).val(ori);
									}
								}
								}else{
									for(var i=0;i<ret.newaddidlist.length;i++){
									$("<span style='width:101px; float:left;line-height:normal;'><input aria-current="+product_id+" style='width:100px;color: #A2A2A2;line-height:normal;' type='text' name='dateEdit' id='dateEdit"+ret.newaddidlist[i][0] +"'value="+ret.newaddidlist[i][1] +"  readonly><input style='width:100px;line-height:normal;' type='text' name='durationEdit'  id='durationEdit"+ret.newaddidlist[i][0] +"' value="+ret.newaddidlist[i][2]+"></span>").appendTo('#historyspan'+product_id)
									var ori = $("#changeIdlist" + product_id).val();
									ori += ret.newaddidlist[i][0] + ",";
									$("#changeIdlist"+product_id).val(ori);
									}
								}
						}
							document.getElementById("history"+product_id).style.display='none';
							$("#history"+product_id).attr("aria-checked","false");
							$("#readstart_time" + product_id).text(ret.edit_stime);
							$("#request_duration" + product_id).text(ret.request_dura);
							$("#daily_duration" + product_id).text(ret.daily_dura);
							if(ret.total != null){
								$("#duration" + product_id).text(ret.total+"Hour");
								$("#totalduration" + product_id).text(ret.total+"Hour");
							}
							else{
								$("#duration" + product_id).text('0Hour');
								$("#totalduration" + product_id).text('0Hour');
							}
							if(ret.utc_time != null){
								$("#close_time" + product_id).text(ret.utc_time);
							}else{
								$("#close_time" + product_id).text('');
							}
							$("#next_target" + product_id).text($('#next_targetEdit' + product_id).val());
							$("#assignid" + product_id).text(ret.assign_ID);
							if($("#from" + product_id).text() == ''){
								$("#assign_starttime" + product_id).text("From:"+$('#assign_starttimeEdit' + product_id).val());
								$("#assign_endtime" + product_id).text("To:"+$('#assign_endtimeEdit' + product_id).val());
							}else{
								$("#assign_starttime" + product_id).text($('#assign_starttimeEdit' + product_id).val());
								$("#assign_endtime" + product_id).text($('#assign_endtimeEdit' + product_id).val());
							}
                            //hide modal
							
                            	$("#planModal"+product_id).modal('hide');
								$("#editPlanForm"+product_id).hide();
								$("#readPlanDiv"+product_id).show();
								$("#editBtn"+product_id).show();
								$("#delBtn"+product_id).show();
                        }
                    })
                }
	</script>
{% endblock %}